<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ACIANexus ‚Ä¢ Kanban</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <link rel="icon" type="image/png" href="img\WhatsApp Image 2025-10-10 at 15.39.08.jpeg" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet">

  <script>
    (function () {
      try {
        var t = localStorage.getItem('theme');
        if (t === 'light') document.documentElement.classList.add('light');
      } catch (_) { }
    })();
  </script>


  <link rel="stylesheet" href="main.css">
</head>

<body>
  <header>
    <div class="xmas-garland"></div>
    <nav class="nav">
      <a href="#/" data-link><img id="logo" alt="ACIA Nexus" class="brand-logo" src="img/logoacianexus.png"></a>
      <a href="#/agenda" data-link>Agenda</a>
      <a href="#/criar" data-link>Criar Tarefa</a>
      <a href="#/kanban" data-link>Kanban</a>
      <a href="#/reportar">Abrir Ticket</a>

      <a href="#/tickets" id="nav-tickets">Tickets</a>
      <a hidden href="#/prospeccao">Prospec√ß√£o</a>
      <a href="#/indicadores" data-link>Indicadores</a>
      <button id="themeToggle" class="btn secondary" type="button">üåô</button>
      <div class="spacer"></div>
      <img src="img/natal.png" alt="" width="70px" height="">
      <div class="spacer"></div>
      <div id="authUserArea" class="auth-user-area hidden">
        <div class="avatar-wrapper">
          <img id="authAvatar" class="auth-avatar" src="">
          <img class="santa-hat" src="img/santahat.png">
        </div>
        <div id="authMenu" class="auth-menu hidden">
          <div class="auth-menu-item" id="authProfile">üë§ Meu Perfil</div>
          <div class="auth-menu-item" id="authLogout">üö™ Sair</div>
        </div>
      </div>

      <button id="btnLogin" class="btn secondary" type="button">Entrar</button>
      <button id="btnLogout" class="btn secondary hidden" type="button">Sair</button>

      <!-- Sino de notifica√ß√µes -->
      <button class="hidden" id="mural-bell" class="icon-button" aria-label="Notifica√ß√µes do mural">
        üîî
        <span id="mural-badge" hidden class="badge"></span>
      </button>

      <div id="mural-dropdown" class="dropdown" hidden>
        <div class="dropdown-head">
          <div style="display:flex; gap:10px;">
            <button id="mural-limpar" class="link hidden">Limpar tudo</button>
            <button id=" mural-marcar-lido" class="link">Marcar tudo como lido</button>
          </div>
        </div>
        <ul id="mural-dropdown-list" class="dropdown-list"></ul>
        <a id="mural-ver-tudo" href="#/mural" class="dropdown-foot">Ver tudo</a>
      </div>



    </nav>
  </header>

  <!-- Faixa de Natal -->
  <div class="christmas-banner">
    üéÑ Feliz Natal, equipe ACIA! üéÖ
  </div>

  <!-- Luzinhas de Natal -->
  <div class="christmas-lights">
    <span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span><a
      href="https://www.youtube.com/watch?v=N0m1nI7gGHs&list=RDN0m1nI7gGHs&start_radio=1"
      target="_blank"><span></span></a>
  </div>


  <main class="container">
    <!-- HOME -->
    <section id="view-home" class="grid" style="grid-template-columns: 1fr; gap: 24px">
      <!-- <div class="hero">
        <div class="chip" style="width:max-content">Central ACIA</div>
        <h1>ACIA Ops ‚Äî Central de Opera√ß√µes</h1>
        <p class="muted" style="font-size:16px;margin:0">
          Mural interno de comunica√ß√£o + atalhos r√°pidos.
        </p>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
          <a class="btn" href="#/kanban">Abrir Kanbans</a>
          <a class="btn secondary" href="#/reportar">Reportar bug</a>
          <a class="btn secondary" href="#/indicadores">Indicadores</a>
        </div>
      </div> -->

      <!-- Mural informativo -->
      <div class="card" style="display:grid; gap:12px">

        <h2 style="margin:0">Mural de Informa√ß√µes</h2>
        <p class="muted" style="margin:0">Comunicados gerais para todos os colaboradores.</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button id="mu-open" class="btn hidden" type="button">Novo Comunicado</button>
        </div>

        <div id="mural-list" style="display:flex;flex-direction:column;gap:10px"></div>

      </div>
    </section>

    <!-- AUTH -->
    <section id="view-auth" class="hidden">
      <div class="card" style="max-width:620px;margin:0 auto">
        <div class="auth-head">
          <h2 style="margin:0">Acessar a Central</h2>
        </div>

        <div class="auth-tabs">
          <button class="auth-tab active" id="auth-tab-login" type="button">Entrar</button>
          <button class="auth-tab" id="auth-tab-register" type="button">Criar conta</button>
        </div>

        <!-- LOGIN -->
        <form id="loginForm" class="auth-pane">
          <div class="field">
            <label for="auth-login-email">E-mail ACIA</label>
            <input id="auth-login-email" type="email" placeholder="seu.nome@acia.com.br" required />
          </div>
          <div class="field">
            <label for="auth-login-pass">Senha</label>
            <input id="auth-login-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
          </div>
          <div class="muted" style="font-size:12px;margin:6px 0">
            <a id="auth-forgot" href="#" style="color:var(--accent)">Esqueci minha senha</a>
          </div>

          <div id="auth-login-msg" class="msg"></div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
            <button id="auth-login-btn" class="btn" type="submit">Entrar</button>
            <button class="btn secondary" type="button" id="auth-to-register">Criar conta</button>
          </div>
        </form>

        <!-- REGISTER -->
        <form id="registerForm" class="auth-pane hidden">
          <div class="field">
            <label for="auth-reg-name">Seu nome</label>
            <input id="auth-reg-name" required type="text" placeholder="Ex.: Maria Silva" />
          </div>
          <div class="field">
            <label for="auth-reg-email">E-mail ACIA</label>
            <input id="auth-reg-email" type="email" placeholder="seu.nome@acia.com.br" required />
          </div>
          <div class="row">
            <div class="field">
              <label for="auth-reg-pass">Senha</label>
              <input id="auth-reg-pass" type="password" placeholder="m√≠n. 6 caracteres" required />
            </div>
            <div class="field">
              <label for="auth-reg-pass2">Confirmar senha</label>
              <input id="auth-reg-pass2" type="password" placeholder="repita a senha" required />
            </div>
          </div>

          <div id="auth-reg-msg" class="msg"></div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
            <button id="auth-reg-btn" class="btn" type="submit">Criar conta</button>
            <button class="btn secondary" type="button" id="auth-to-login">J√° tenho conta</button>
          </div>
        </form>
      </div>
    </section>


    <section id="view-create" class="hidden">
      <div class="card" style="max-width:900px;margin:0 auto">
        <h2 style="margin:0 0 10px">Criar Tarefa</h2>

        <div class="row">
          <div class="field">
            <label for="c-title">T√≠tulo</label>
            <input id="c-title" type="text" placeholder="Ex.: Planejar a√ß√µes para a campanha X" />
          </div>
          <div class="field">
            <label for="c-board">Kanban</label>
            <select id="c-board">
              <option value="PROJETOS">Projetos</option>
              <option value="ROTINAS">Rotinas</option>
              <option value="EVENTOS">Eventos</option>
              <option value="VENDAS">Vendas</option>
              <!--<option value="COMPRAS">Compras</option>-->
            </select>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="c-solic">Solicitante</label>
            <input id="c-solic" type="text" disabled />
          </div>
          <div class="field">
            <label for="c-resp">Respons√°vel</label>
            <select id="c-resp"></select>
          </div>
          <div class="field">
            <label for="c-due">Prazo</label>
            <input id="c-due" type="datetime-local" />
          </div>
        </div>
        <div class="card" style="margin:12px 0 14px">
          <div id="c-gut-block" class="card" style="margin:12px 0 14px">
            <h3 style="margin:0 0 8px">GUT (1‚Äì5)</h3>
            <div class="row" style="grid-template-columns: repeat(4, 1fr)">
              <div class="field">
                <label for="c-g">G</label>
                <input id="c-g" type="number" min="1" max="5" value="5" />
              </div>
              <div class="field">
                <label for="c-u">U</label>
                <input id="c-u" type="number" min="1" max="5" value="5" />
              </div>
              <div class="field">
                <label for="c-t">T</label>
                <input id="c-t" type="number" min="1" max="5" value="5" />
              </div>
              <div class="field">
                <label>Total (G√óU√óT)</label>
                <input id="c-gut" type="text" disabled value="125" />
              </div>
            </div>
          </div>
          <!-- MEMBROS DO CARD -->


          <!-- MEMBROS DO CARD -->
          <div class="row">
            <div class="field" style="flex:1">
              <label for="c-members">Envolvidos</label>
              <div id="c-members" class="select-members">Selecione...</div>
            </div>

            <!-- ANEXOS -->
            <div class="field" style="flex:1">
              <label>Anexos</label>
              <div id="c-attachments" style="margin-bottom:6px"></div>

              <div style="display:flex; gap:8px; margin-top:6px;">
                <button id="c-send-attach" class="btn secondary" type="button">
                  Anexar arquivo
                </button>
                <input id="c-file-input" type="file" multiple hidden />
              </div>
              <p style="font-size: 12px;">S√≥ imagens podem ser anexadas (por enquanto üòâ)</p>
            </div>
          </div>

          <!-- Tarefa linkada (subtarefa) -->
          <div class="row">
            <div class="field" style="grid-column: 1 / -1">
              <label for="c-parent">Subtarefa vinculada a:</label>
              <select id="c-parent">
                <option value="">‚ÄîNenhuma‚Äî</option>
              </select>
            </div>
          </div>

          <!-- === Descritivo da Tarefa === -->
          <div class="desc-grid">
            <div class="field">
              <label for="md-objetivo">Objetivo</label>
              <textarea id="md-objetivo" placeholder="Descreva o objetivo..."></textarea>
            </div>

            <div class="field">
              <label for="md-acoes">Descri√ß√£o</label>
              <textarea id="md-acoes" placeholder="Explique as a√ß√µes, etapas, crit√©rios de aceite..."></textarea>
            </div>

            <div class="field full-row">
              <label for="md-info">Informa√ß√µes Adicionais</label>
              <textarea id="md-info" placeholder="Links, observa√ß√µes, anexos, refer√™ncias..."></textarea>
            </div>
          </div>


          <div class="field" style="display:flex;gap:8px;align-items:center;margin-top:6px">
            <input id="c-new-check" type="text" placeholder="Novo item da checklist‚Ä¶" />
            <button id="c-add-check" class="btn secondary" type="button">Adicionar √† Checklist</button>
          </div>
        </div>
        <!-- Descri√ß√£o (agora oculta, preenchida automaticamente) -->


        <!-- Descri√ß√£o (agora oculta, preenchida automaticamente) -->
        <textarea id="c-desc" hidden></textarea>

        <!-- Checklist (gerada do modelo) -->
        <div>
          <h4 style="margin:10px 0 6px">Checklist (gerada do modelo)</h4>
          <div id="c-checklist"></div>
        </div>

        <div style="display:flex;gap:10px;align-items:center;margin-top:8px;flex-wrap:wrap">
          <button id="c-ai" class="btn secondary hidden" type="button">Gerar Checklist com IA</button>
          <button id="c-create" class="btn" type="button">Gerar Card</button>
          <span id="c-msg" class="msg"></span>
        </div>





        <!-- ROTINAS -->
        <div id="rt-block" class="card hidden" style="margin:12px 0 14px">
          <div class="card" style="margin:12px 0 14px">
            <h3 style="margin:0 0 8px">Rotinas</h3>
            <div class="row">
              <div class="field">
                <label for="c-rt-enabled">Ativar rotina</label>
                <select required id="c-rt-enabled">
                  <option value="on">Ativada</option>
                </select>
              </div>
              <div class="field">
                <label for="c-rt-kind">Periodicidade</label>
                <select required id="c-rt-kind">
                  <option value="DAILY">Diariamente</option>
                  <option value="WEEKLY">Semanalmente</option>
                  <option value="BIWEEKLY">Quinzenalmente</option>
                  <option value="MONTHLY">Mensalmente</option>
                  <option value="MON">Toda segunda</option>
                  <option value="TUE">Toda ter√ßa</option>
                  <option value="WED">Toda quarta</option>
                  <option value="THU">Toda quinta</option>
                  <option value="FRI">Toda sexta</option>
                </select>
              </div>
            </div>
            <p class="muted" style="margin:6px 0 0;font-size:12px">
              Os prazos das tarefas rotineiras, s√£o definidos por cada respons√°vel. Quando o prazo √© vencido, a
              tarefa √© gerada novamente e aplicada no in√≠cio do fluxo automaticamente.
            </p>
          </div>
        </div>

        <div>
          <div id="c-checklist"></div>
        </div>
      </div>
    </section>

    <section id="view-report" class="hidden">
      <h2>Abrir Ticket de Suporte</h2>
      <form id="formTicket">
        <label>T√≠tulo:</label>
        <input type="text" id="ticketTitle" required />

        <label>Descri√ß√£o:</label>
        <textarea id="ticketDesc" required></textarea>

        <label class="hidden">Setor:</label>
        <select class="hidden" id="ticketDept" required>
          <option value="TI">TI</option>
        </select>
        <br><br>

        <button class="btn" type="submit">Enviar Ticket</button>
      </form>
    </section>


    <!-- AGENDA / CALEND√ÅRIO -->
    <section id="view-calendar" class="hidden">
      <div class="card">
        <div style="display:flex;align-items:center;gap:12px;">
          <h2 style="margin:0" id="cal-title">Agenda</h2>
          <div class="spacer"></div>
          <div style="display:flex;gap:8px">
            <button id="cal-prev" class="btn secondary" type="button">‚óÄ</button>
            <button id="cal-today" class="btn secondary" type="button">Hoje</button>
            <button id="cal-next" class="btn secondary" type="button">‚ñ∂</button>
          </div>
        </div>

        <div id="calendar" style="margin-top:12px;">
          <style>
            /* Calendar small styles */
            #cal-grid {
              width: 100%;
            }

            .cal-day.muted {
              opacity: 0.45
            }

            .cal-day .cal-events .cal-evt:hover {
              background: rgba(59, 130, 246, .08);
            }
          </style>

          <div id="cal-grid" class="card" style="padding:12px;"></div>
          <div id="cal-list" style="margin-top:12px"></div>
        </div>
      </div>
    </section>

    <!-- MODAL AGENDA -->
    <div id="calendarModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="cal-modal-title">
      <div class="modal-head">
        <strong id="cal-modal-title">Novo evento</strong>
        <button id="cal-close" class="btn secondary" type="button">Fechar</button>
      </div>

      <div class="modal-body">
        <div class="field"><label>Data</label><input id="evt-date" type="date" /></div>
        <div class="field"><label>Hor√°rio</label><input id="evt-time" type="time" /></div>
        <div class="field"><label>T√≠tulo</label><input id="evt-title" type="text" /></div>
        <div class="field"><label>Respons√°veis (v√≠rgula)</label><input id="evt-resp" type="text"
            placeholder="Maria, Jo√£o" /></div>
        <div class="field"><label>Descri√ß√£o</label><textarea id="evt-desc"></textarea></div>
        <div id="evt-msg" class="msg"></div>
      </div>

      <div class="modal-foot">
        <button id="evt-delete" class="btn secondary" type="button">Excluir</button>
        <button id="evt-save" class="btn" type="button">Salvar</button>
      </div>
    </div>

    <!-- KANBANS -->
    <section id="view-kanban" class="hidden">

      <div class="card">
        <div class="tabs" id="kb-tabs">
          <div class="tab active" data-b="PROJETOS">Projetos</div>
          <div class="tab" data-b="ROTINAS">Rotinas</div>
          <div class="tab" data-b="EVENTOS">Eventos</div>
          <div class="tab" data-b="VENDAS">Vendas</div>
          <input id="k-q" type="search" placeholder="Buscar por t√≠tulo‚Ä¶" />
          <div style="display:flex;gap:8px;align-items:center">
            <select id="k-resp" title="Respons√°vel"></select>
          </div>
          <!--<div class="tab" data-b="COMPRAS">Compras</div>-->
          <div class="spacer"></div>
          <button id="k-refresh" class="btn">Atualizar</button>

        </div>

        <div class="kpis" id="kpis"></div>


        <div class="kanban-wrap" style="margin-top:12px">
          <div id="columns" class="columns"></div>
        </div>

      </div>
    </section>

    <!-- PROSPEC√á√ÉO -->
    <section id="view-prospec" class="hidden">
      <div class="card">
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
          <div>
            <h2 style="margin:0">Prospec√ß√£o ‚Äî CNPJs de Americana</h2>
            <p class="muted" style="margin:2px 0 0;font-size:13px">
              Esta aba carrega automaticamente, 1x por m√™s, a base de CNPJs de Americana
              a partir de um arquivo JSON no Firebase Storage.
            </p>
          </div>
          <div class="spacer"></div>
          <button id="pros-sync" class="btn secondary" type="button">
            For√ßar atualiza√ß√£o
          </button>
        </div>

        <div id="pros-msg" class="msg" style="margin-bottom:8px"></div>

        <div class="toolbar" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px">
          <div style="display:flex;gap:6px;align-items:center">
            <button id="pros-filter-all" class="btn small active" type="button">
              Todos os CNPJs
            </button>
            <button id="pros-filter-new" class="btn small secondary" type="button">
              Apenas novos do m√™s
            </button>
          </div>

          <input id="pros-q" type="search" placeholder="Buscar por nome, raz√£o social ou CNPJ‚Ä¶"
            style="flex:1 1 220px;min-width:160px" />

          <select id="pros-activity" style="min-width:180px">
            <option value="">Todas as atividades</option>
          </select>

          <select id="pros-situacao" style="min-width:140px">
            <option value="">Situa√ß√£o: todas</option>
            <option value="ATIVA">Somente ativas</option>
            <option value="BAIXADA">Somente baixadas</option>
          </select>
        </div>

        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;font-size:13px">
          <div id="pros-count" class="muted">0 registros</div>
          <div id="pros-last-sync" class="muted">√öltima atualiza√ß√£o: ‚Äî</div>
        </div>

        <div class="table-wrap">
          <table class="data-table">
            <thead>
              <tr>
                <th style="min-width:120px">CNPJ</th>
                <th style="min-width:160px">Nome Fantasia</th>
                <th style="min-width:200px">Raz√£o Social</th>
                <th style="min-width:110px">Abertura</th>
                <th style="min-width:160px">Atividade principal</th>
                <th style="min-width:90px">Situa√ß√£o</th>
                <th style="min-width:200px">Contato</th>
              </tr>
            </thead>
            <tbody id="pros-tbody">
              <tr>
                <td colspan="7" class="muted">Nenhum dado carregado ainda.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>


    <!-- INDICADORES -->
    <section id="view-metrics" class="hidden">
      <div class="card">
        <h2 style="margin:0 0 10px">Indicadores</h2>
        <section id="ranking-section" style="margin-top:30px">

          <h2>üèÜ Ranking</h2>

          <div id="ranking-list"></div>

        </section>



        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:12px">
          <select id="m-board" title="Board">
            <option value="ALL" selected>Todos os boards</option>
            <option value="PROJETOS">Projetos</option>
            <option value="ROTINAS">Rotinas</option>
            <option value="EVENTOS">Eventos</option>
            <option value="VENDAS">Vendas</option>
          </select>

          <select id="m-period" title="Per√≠odo">
            <option value="30" selected>√öltimos 30 dias</option>
            <option value="90">√öltimos 90 dias</option>
            <option value="365">√öltimos 12 meses</option>
            <option value="0">Todo per√≠odo</option>
          </select>

          <button id="m-refresh" class="btn">Atualizar</button>
          <div class="spacer"></div>
          <button id="m-export" class="btn secondary">Exportar XLSX</button>
        </div>

        <div id="m-kpis" class="kpis"></div>
        <div id="risk-panel" class="kpis" style="margin-top:8px"></div>
        <section class="hidden" id="activity-section" style="margin-top:20px">
          <h2 style="margin-bottom:8px">Mapa de Atividade</h2>

          <div id="heatmap" class="heatmap"></div>

          <h3 class="hidden" style="margin-top:20px">Produtividade por hor√°rio</h3>
          <canvas id="prodHourChart" width="600" height="200"></canvas>

          <h3 hidden style="margin-top:20px">Produtividade por dia</h3>
          <canvas hidden id="prodDayChart" width="600" height="200"></canvas>
        </section>


        <div class="grid" style="grid-template-columns:1fr 1fr;gap:14px;margin-top:12px">
          <div class="card">
            <h3 style="margin:0 0 8px">Cards por status</h3>
            <canvas id="chartStatus" height="220"></canvas>
          </div>
          <div class="card">
            <h3 style="margin:0 0 8px">Cards por respons√°vel</h3>
            <canvas id="chartResp" height="220"></canvas>
          </div>
        </div>

        <div class="grid" style="grid-template-columns:1fr;gap:14px;margin-top:12px">
          <div class="card">
            <h3 style="margin:0 0 8px">Cards por board</h3>
            <canvas id="chartBoard" height="240"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- MEMBROS -->
    <section id="view-members" class="hidden">
      <div class="card" style="max-width:900px;margin:0 auto">
        <h2 style="margin:0 0 10px">Membros</h2>
        <p class="muted" style="margin:0 0 12px">Gerencie os pap√©is (viewer, editor, admin). Somente
          <strong>admin</strong> pode alterar.
        </p>

        <div id="memb-msg" class="msg"></div>

        <div class="row" style="margin-bottom:10px">
          <div class="field">
            <label>Nome</label>
            <input id="mb-name" type="text" placeholder="Nome" />
          </div>
          <div class="field">
            <label>E-mail</label>
            <input id="mb-email" type="email" placeholder="email@exemplo.com" />
          </div>
        </div>
        <div class="row" style="margin-bottom:10px">
          <div class="field">
            <label>Papel</label>
            <select id="mb-role">
              <option value="viewer">viewer</option>
              <option value="editor" selected>editor</option>
              <option value="admin">admin</option>
            </select>
          </div>
          <div class="field" style="display:flex;align-items:flex-end">
            <button id="mb-add" class="btn secondary" type="button">Adicionar/Atualizar</button>
          </div>
        </div>

        <div class="kpis" style="grid-template-columns:1fr">
          <div class="kpi-card">
            <div class="kpi-title">Equipe</div>
            <div id="mb-list" style="margin-top:8px"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== Tickets (somente TI/admin) ===== -->
    <section id="view-tickets" class="view hidden">
      <div class="toolbar"
        style="display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:12px">
        <div style="display:flex;gap:8px;align-items:center">
          <select id="tkt-filter">
            <option value="ALL">Todos</option>
            <option value="Aberto">Aberto</option>
            <option value="Em andamento">Em andamento</option>
            <option value="Resolvido">Resolvido</option>
            <option value="Fechado">Fechado</option>
          </select>
          <input id="tkt-q" type="search" placeholder="Buscar por t√≠tulo ou autor‚Ä¶" />
        </div>
        <div id="tkt-counter" class="muted">0 tickets</div>
      </div>

      <div id="tickets-list" style="display:flex;flex-direction:column;gap:10px"></div>
    </section>

    <!-- Modal do ticket -->
    <div id="ticketModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="ticket-title">
      <div class="modal-panel">
        <div class="modal-head">
          <h3 id="ticket-title">Ticket</h3>
          <button id="ticket-close" aria-label="Fechar" title="Fechar">
            <!-- X simples (sem SVG) para compatibilidade -->
            ‚úï
          </button>
        </div>
        <div class="modal-body">
          <div class="grid" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px">
            <label>Autor
              <input id="ticket-author" type="text" disabled />
            </label>
            <label>E-mail
              <input id="ticket-email" type="text" disabled />
            </label>
          </div>

          <label style="margin-top:8px">Descri√ß√£o
            <textarea id="ticket-desc" rows="5" disabled></textarea>
          </label>

          <div class="grid" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px">
            <label class="hidden">Severidade
              <select class="hidden" id="ticket-severity" disabled>
                <option>Baixa</option>
                <option>M√©dia</option>
                <option>Alta</option>
              </select>
            </label>
            <label>Status
              <select id="ticket-status">
                <option>Aberto</option>
                <option>Em andamento</option>
                <option>Resolvido</option>
                <option>Fechado</option>
              </select>
            </label>
          </div>

          <label style="margin-top:8px">Feedback do TI
            <textarea id="ticket-feedback" rows="4"
              placeholder="Escreva um retorno objetivo para o solicitante‚Ä¶"></textarea>
          </label>
        </div>

        <div class="modal-foot">
          <span id="tkt-msg" class="msg"></span>
          <button id="ticket-save" class="btn">Salvar</button>
        </div>
      </div>
    </div>

    <!-- Backdrop exclusivo dos tickets (o JS usa #backdrop) -->
    <div id="backdrop" class="modal-backdrop hidden"></div>


  </main>

  <footer class="footer">
    <div class="footer-content">
      <p>
        ¬© <span id="current-year"></span>
        <strong>ACIANexus</strong> ‚Äî Plataforma desenvolvida por
        <a href="mailto:ssgobin.dev@gmail.com" target="_blank">Jo√£o Vitor Sgobin</a>.
      </p>
      <p class="muted">
        Sistema baseado na engine <strong>Nuvvo</strong>.
        <a href="politica.html" target="_blank">Pol√≠tica de Privacidade</a>
      </p>
    </div>
  </footer>

  <script>
    document.getElementById("current-year").textContent = new Date().getFullYear();
  </script>

  <style>
    .footer {
      margin-top: 40px;
      padding: 20px 10px;
      text-align: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 14px;
      color: var(--muted-color, #bbb);
    }

    .footer a {
      color: var(--accent-color, #0af);
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    .footer .muted {
      font-size: 13px;
      color: #999;
    }
  </style>



  <!-- MODAL: Novo Comunicado do Mural (apenas admin) -->
  <div id="muralModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mu-title-h">
    <div class="modal-head">
      <strong id="mu-title-h">Novo Comunicado</strong>
      <button id="mu-close" class="btn secondary" type="button">Fechar</button>
    </div>

    <div class="modal-body">
      <div class="row">
        <div class="field">
          <label for="mu-title">T√≠tulo</label>
          <input id="mu-title" type="text" placeholder="Ex.: Campanha de fim de ano" />
        </div>
        <div class="field">
          <label for="mu-cat">Categoria</label>
          <select id="mu-cat">
            <option>Vendas</option>
            <option>Eventos</option>
            <option>RH</option>
            <option>Opera√ß√µes</option>
            <option>Geral</option>
            <option>Sistema</option>
          </select>
        </div>
      </div>
      <div class="field">
        <label for="mu-text">Mensagem</label>
        <textarea id="mu-text" placeholder="Conte√∫do objetivo do comunicado."></textarea>
      </div>
      <div id="mu-msg" class="msg"></div>
    </div>

    <div class="modal-foot">
      <button id="mu-publish" class="btn" type="button">Publicar</button>
    </div>
  </div>

  <div id="modalBack" class="backdrop"></div>

  <!-- MODAL EDITAR CARD (ajustado a partir do original) -->
  <div id="cardModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="m-title">

  <!-- LADO ESQUERDO DO MODAL -->
  <div class="modal-inner">

    <div class="modal-head">
      <strong id="m-title">Editar card</strong>
      <div style="display:flex;gap:8px;align-items:center">
        <span id="m-badge-gut" class="hidden badge">GUT: 0 (C)</span>
        <span id="m-badge-pri" class="hidden badge">PRI: 0</span>
        <button id="m-open-chat" class="btn secondary hidden" type="button" title="Abrir chat">Chat</button>
        <button id="m-close" class="btn secondary" type="button">Fechar</button>
      </div>
    </div>

    <div class="modal-body">

      <!-- Linha 1 ‚Äì T√≠tulo + Kanban -->
      <div class="row">
        <div class="field">
          <label for="m-title-in">T√≠tulo</label>
          <input id="m-title-in" type="text" />
        </div>

        <div class="field">
          <label for="m-board">Kanban</label>
          <select id="m-board" disabled>
            <option value="PROJETOS">Projetos</option>
            <option value="ROTINAS">Rotinas</option>
            <option value="EVENTOS">Eventos</option>
            <option value="VENDAS">Vendas</option>
          </select>
        </div>
      </div>

      <!-- Linha 2 ‚Äì Solicitante / Respons√°vel / Status / Prazo -->
      <div class="row">
        <div class="field">
          <label for="m-solic">Solicitante</label>
          <input id="m-solic" type="text" disabled />
        </div>

        <div class="field">
          <label for="m-resp">Respons√°vel</label>
          <select id="m-resp"></select>
        </div>

        <div class="field">
          <label for="m-status">Status</label>
          <select id="m-status"></select>
        </div>

        <div class="field">
          <label for="m-due">Prazo</label>
          <input id="m-due" type="datetime-local" />
        </div>
      </div>

      <!-- GUT -->
      <h3 style="margin:0 0 8px">GUT (1‚Äì5)</h3>

      <div class="row" style="grid-template-columns: repeat(4, 1fr);">
        <div class="field">
          <label for="m-g">Gravidade (G)</label>
          <input id="m-g" type="number" min="1" max="5" />
        </div>

        <div class="field">
          <label for="m-u">Urg√™ncia (U)</label>
          <input id="m-u" type="number" min="1" max="5" />
        </div>

        <div class="field">
          <label for="m-t">Tend√™ncia (T)</label>
          <input id="m-t" type="number" min="1" max="5" />
        </div>

        <div class="field">
          <label for="m-gut">Resultado (G√óU√óT)</label>
          <input id="m-gut" type="text" disabled />
        </div>
      </div>

      <!-- Envolvidos + Anexos -->
      <div class="row">
        <div class="field" style="flex:1">
          <label for="m-members">Envolvidos</label>
          <div id="m-members" class="select-members"></div>
        </div>

        <div class="field" style="flex:1">
          <label>Anexos</label>

          <div id="m-attachments" style="margin-bottom:6px"></div>

          <div style="display:flex;gap:8px;margin-top:6px">
            <input id="m-new-attach" type="url" class="hidden" placeholder="URL do anexo‚Ä¶" style="flex:1" />
            <button id="m-send-attach" class="btn secondary" type="button">Anexar</button>
          </div>
        </div>
      </div>

      <!-- Tarefa linkada -->
      <div class="field">
        <label for="m-parent">Tarefa linkada com</label>
        <select id="m-parent">
          <option value="">‚ÄîNenhuma‚Äî</option>
        </select>
        <p class="muted" style="margin:6px 0 0;font-size:12px">
          Use para vincular esta tarefa como subtarefa de uma tarefa-m√£e.
        </p>
      </div>

      <!-- Rotinas -->
      <div id="m-rt-block" class="card hidden" style="margin:6px 0">
        <h4 style="margin:0 0 6px">Rotinas</h4>
        <div class="row hidden">
          <div class="field hidden">
            <label for="m-rt-enabled">Ativar rotina</label>
            <select id="m-rt-enabled">
              <option value="off">Desativada</option>
              <option value="on">Ativada</option>
            </select>
          </div>
          <div class="field">
            <label for="m-rt-kind">Periodicidade</label>
            <select id="m-rt-kind">
              <option value="DAILY">Diariamente</option>
              <option value="WEEKLY">Semanalmente</option>
              <option value="BIWEEKLY">Quinzenalmente</option>
              <option value="MONTHLY">Mensalmente</option>
              <option value="MON">Toda segunda</option>
              <option value="TUE">Toda ter√ßa</option>
              <option value="WED">Toda quarta</option>
              <option value="THU">Toda quinta</option>
              <option value="FRI">Toda sexta</option>
            </select>
          </div>
        </div>
        <p class="muted" style="margin:6px 0 0;font-size:12px">
          Com rotina ativada, ao ‚Äúbater‚Äù o prazo o card volta ao in√≠cio do fluxo e o pr√≥ximo prazo √© calculado automaticamente.
        </p>
      </div>

      <!-- Descritivo -->
      <h3 class="subtitle">üß© Descritivo da Tarefa</h3>

      <div id="m-desc-block" class="desc-grid">
        <div class="field">
          <label for="m-md-objetivo">üéØ Objetivo da Tarefa</label>
          <textarea id="m-md-objetivo" placeholder="Descreva o objetivo..."></textarea>
        </div>

        <div class="field">
          <label for="m-md-acoes">üß≠ Descrever a Tarefa</label>
          <textarea id="m-md-acoes" placeholder="Explique as a√ß√µes, etapas e crit√©rios de aceite..."></textarea>
        </div>

        <div class="field full-row">
          <label for="m-md-info">üìé Informa√ß√µes Adicionais</label>
          <textarea id="m-md-info" placeholder="Links, observa√ß√µes, anexos, refer√™ncias..."></textarea>
        </div>
      </div>

      <div class="field hidden">
        <label for="m-desc">Descri√ß√£o</label>
        <textarea id="m-desc" rows="6"></textarea>
      </div>

      <!-- Checklist -->
      <div>
        <h4 style="margin:0 0 6px">Checklist</h4>

        <div id="m-checklist"></div>

        <div class="field" style="margin-top:6px;display:flex;gap:8px">
          <input id="m-new-check" type="text" placeholder="Novo item‚Ä¶" />
          <button id="m-add-check" class="btn secondary" type="button">Adicionar</button>
        </div>
      </div>

    </div><!-- modal-body -->

    <div class="modal-foot">
      <button id="m-copy-link" class="btn secondary">üîó Copiar link</button>
      <button id="m-delete" class="btn secondary" type="button">Excluir</button>
      <button id="m-save" class="btn" type="button">Salvar</button>
    </div>

  </div><!-- modal-inner -->

  <!-- PAINEL DE ATIVIDADE (LADO DIREITO) -->
  <div id="card-activity-panel" class="activity-panel">
    <div class="activity-header">Coment√°rios e atividade</div>

    <div id="activity-list" class="activity-list">
      <div class="muted">Carregando...</div>
    </div>

    <div class="activity-input">
      <textarea id="activity-msg" placeholder="Escreva um coment√°rio..."></textarea>
      <button id="activity-send">Enviar</button>
    </div>
  </div>

</div><!-- cardModal -->



  <!-- MODAL DE CHAT (por card) -->
  <div id="chatModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="chat-title">
    <div class="modal-head">
      <strong id="chat-title">Chat</strong>
      <button id="chat-close" class="btn secondary" type="button">Fechar</button>
    </div>
    <div class="modal-body">
      <div id="chat-list" style="display:flex;flex-direction:column;gap:8px;max-height:55vh;overflow:auto"></div>
    </div>
    <div class="modal-foot">
      <input id="chat-text" type="text" placeholder="Escreva uma mensagem‚Ä¶" />
      <button id="chat-send" class="btn" type="button">Enviar</button>
    </div>
  </div>

  <!-- ===== POPUP DI√ÅRIO ===== -->
  <div id="dailyModal">
    <div class="modal-container">
      <div class="modal-head">Relat√≥rio Di√°rio</div>
      <div class="modal-body" id="dailyBody">

        <button id="addMore" class="btn secondary">+ Adicionar outro intervalo</button>
      </div>
      <div class="modal-foot">
        <button id="saveDaily" class="btn">Salvar</button>
      </div>
    </div>
  </div>

  <!-- ===== POPUP DE POL√çTICA DE PRIVACIDADE ===== -->
  <div id="privacyPopup" class="privacy-popup hidden">
    <div class="privacy-box">
      <h3>Pol√≠tica de Privacidade</h3>
      <p>
        Utilizamos este sistema conforme nossa <a href="politica.html" target="_blank">Pol√≠tica de
          Privacidade</a>.
        Ao continuar, voc√™ confirma que leu e concorda com o tratamento de seus dados conforme descrito.
      </p>
      <div class="privacy-actions">
        <button id="acceptPrivacy" class="btn">Aceitar e continuar</button>
      </div>
    </div>
  </div>

  <!-- PAINEL FLUTUANTE DO CHAT -->
  <div id="chat-panel" class="chat-panel">

    <div class="chat-header">
      <strong>üí¨ Chat Global</strong>
    </div>

    <!-- Sidebar + Chat lado a lado -->
    <div class="chat-layout">

      <!-- SIDEBAR DO CHAT GLOBAL (ID EXCLUSIVO) -->
      <div id="chat-global-sidebar" class="chat-sidebar-global">
        <h3>üü¢ Online</h3>
        <ul id="online-list"></ul>
      </div>

      <div class="chat-content">
        <div id="chat-box" class="chat-box"></div>

        <div id="typing-indicator" class="muted" style="display:none;font-size:12px;margin:6px 0;">
          Algu√©m est√° digitando...
        </div>

        <div class="chat-input">
          <button id="gif-btn" class="btn gif-btn">üéûÔ∏è</button>
          <div id="emoji-picker" class="emoji-picker"></div>
          <input id="chat-input" type="text" placeholder="Digite..." />
        </div>
      </div>

    </div>
  </div>

  <div id="profile-modal" class="profile-modal" style="display:none">
    <div class="profile-card">
      <div class="profile-header">
        <h3>Meu Perfil</h3>
        <button id="profile-close" class="profile-close">√ó</button>
      </div>

      <div class="profile-body">
        <div class="profile-avatar-area">
          <img id="profile-avatar-preview" class="profile-avatar-img" src="" alt="Foto">
          <br>
          <button id="profile-change-photo" type="button">Trocar foto</button>
          <input id="profile-photo" type="file" accept="image/*" style="display:none">
        </div>

        <label for="profile-name">Nome</label>
        <input id="profile-name" type="text">

        <label for="profile-role">Cargo</label>
        <input id="profile-role" type="text" placeholder="Ex: Admin, Atendimento, Comercial">

        <label for="profile-phone">Telefone</label>
        <input id="profile-phone" type="text">

        <label for="profile-bio">Bio</label>
        <textarea id="profile-bio" rows="3"></textarea>
      </div>

      <button id="profile-save" type="button" class="profile-save">Salvar</button>
    </div>
  </div>

  <!-- ==== MODAL GLOBAL DE ENVOLVIDOS ==== -->
  <div id="members-modal" class="members-modal hidden">
    <div class="members-modal-content">

      <div class="members-modal-header">
        <h3>Selecionar Envolvidos</h3>
        <button id="members-close" class="close-btn">‚úñ</button>
      </div>

      <input id="members-search" class="members-search" placeholder="Pesquisar por nome...">

      <div id="members-list" class="members-list"></div>

      <button id="members-apply" class="apply-btn">Aplicar Sele√ß√£o</button>
    </div>
  </div>


  <!-- BOT√ÉO FLUTUANTE -->
  <button id="chat-toggle-btn" class="chat-fab">üí¨</button>

  <script type="module" src="script.js"></script>
  <script>
    UPLOADCARE_PUBLIC_KEY = 'bec8b0653d0455ca2d7d'; // substitua pela sua chave
  </script>
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>
  <div id="toast"></div>
</body>

</html>